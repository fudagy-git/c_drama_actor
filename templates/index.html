<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>원페이지 배우 게시판</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 20px; line-height: 1.6; background-color: #f4f4f4; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        h1, h2 { text-align: center; color: #333; }
        .post-list { list-style: none; padding: 0; }
        .post-item { background: #fff; margin-bottom: 20px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; gap: 20px; }
        .post-image { max-width: 150px; height: 150px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .post-content { flex-grow: 1; overflow-wrap: break-word; }
        .post-content h3 { margin-top: 0; }
        .post-content a { color: #007BFF; text-decoration: none; }
        .post-content p { white-space: pre-wrap; }
        .form-section { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input[type="text"], input[type="url"], input[type="password"], textarea { width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        input[type="file"] { margin-bottom: 10px; }
        button { background: #007BFF; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        button.delete { background: #DC3545; }
        button.edit { background: #28A745; }
        .actions { margin-top: 10px; display: flex; gap: 10px; }
        .flash-messages { list-style: none; padding: 0; margin-bottom: 20px; }
        .flash-messages li { padding: 15px; margin-bottom: 10px; border-radius: 4px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        
        /* 페이지네이션 스타일 */
        .pagination { text-align: center; margin-top: 20px; margin-bottom: 20px; }
        .pagination a, .pagination strong { display: inline-block; padding: 8px 12px; margin: 0 4px; border: 1px solid #ddd; text-decoration: none; color: #007BFF; border-radius: 4px; }
        .pagination strong.current-page { background-color: #007BFF; color: white; border-color: #007BFF; }
        .pagination a:hover { background-color: #f4f4f4; }
    </style>
</head>
<body>

    <div class="header">
        <h1>원페이지 배우 게시판</h1>
        <a href="{{ url_for('logout') }}">로그아웃</a>
    </div>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flash-messages">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <h2>리스트</h2>
    <ul class="post-list">
        <!-- posts.items 로 변경 -->
        {% for post in posts.items %}
        <li class="post-item">
            {% if post.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' + post.image_filename) }}" alt="{{ post.actor_name }}" class="post-image">
            {% else %}
                <img src="https://via.placeholder.com/150" alt="No Image" class="post-image">
            {% endif %}
            <div class="post-content">
                <h3>{{ post.actor_name }}</h3>
                <p><strong>링크:</strong> <a href="{{ post.link_url }}" target="_blank">{{ post.link_url }}</a></p>
                <p><strong>메모:</strong><br>{{ post.memo }}</p>
                <small><strong>작성자:</strong> {{ post.author }}</small>
                
                <div class="actions">
                    <button class="edit" onclick="showEditModal({{ post.id }}, '{{ post.actor_name }}', '{{ post.link_url or '' }}', '{{ post.memo or '' }}', '{{ post.author }}')">수정하기</button>
                    <button class="delete" onclick="showDeleteModal({{ post.id }})">삭제하기</button>
                </div>
            </div>
        </li>
        {% else %}
        <li>게시글이 없습니다. 첫 번째 글을 작성해보세요!</li>
        {% endfor %}
    </ul>

    <!-- 페이지네이션 링크 추가 -->
    <div class="pagination">
        {% if posts.has_prev %}
            <a href="{{ url_for('index', page=posts.prev_num) }}">&laquo; 이전</a>
        {% endif %}
        {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if posts.page == page_num %}
                    <strong class="current-page">{{ page_num }}</strong>
                {% else %}
                    <a href="{{ url_for('index', page=page_num) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                ...
            {% endif %}
        {% endfor %}
        {% if posts.has_next %}
            <a href="{{ url_for('index', page=posts.next_num) }}">다음 &raquo;</a>
        {% endif %}
    </div>

    <hr>

    <div class="form-section">
        <h2>글쓰기</h2>
        <form action="{{ url_for('add_post') }}" method="post" enctype="multipart/form-data">
            <input type="text" name="actor_name" placeholder="배우명 (필수)" required>
            <input type="url" name="link_url" placeholder="링크주소 (예: https://...)">
            <textarea name="memo" placeholder="메모" rows="4"></textarea>
            <input type="text" name="author" placeholder="작성자 (필수)" required>
            <input type="password" name="password" placeholder="비밀번호 (필수)" required>
            <label for="image">이미지 첨부:</label>
            <input type="file" name="image" accept="image/*">
            <button type="submit">작성하기</button>
        </form>
    </div>

    <!-- 삭제 확인 Modal -->
    <div id="deleteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 10;">
        <div style="background:white; width:300px; padding:20px; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); border-radius: 8px;">
            <h3>게시글 삭제</h3>
            <p>삭제하시려면 비밀번호를 입력하세요.</p>
            <form action="{{ url_for('delete_post') }}" method="post">
                <input type="hidden" name="post_id" id="delete_post_id">
                <input type="password" name="password" placeholder="비밀번호" required>
                <button type="submit" class="delete">삭제 확인</button>
                <button type="button" onclick="document.getElementById('deleteModal').style.display='none'">취소</button>
            </form>
        </div>
    </div>
    
    <!-- 수정 Modal -->
    <div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 10;">
        <div style="background:white; width:500px; padding:20px; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); border-radius: 8px;">
            <h3>게시글 수정</h3>
            <form id="editForm" method="post" enctype="multipart/form-data">
                <input type="text" id="edit_actor_name" name="actor_name" required>
                <input type="url" id="edit_link_url" name="link_url">
                <textarea id="edit_memo" name="memo" rows="4"></textarea>
                <input type="text" id="edit_author" name="author" required>
                <label for="image">이미지 변경 (선택):</label>
                <input type="file" name="image" accept="image/*">
                <input type="password" name="password" placeholder="비밀번호 확인" required>
                <button type="submit" class="edit">수정 완료</button>
                <button type="button" onclick="document.getElementById('editModal').style.display='none'">취소</button>
            </form>
        </div>
    </div>

    <script>
        function showDeleteModal(postId) {
            document.getElementById('delete_post_id').value = postId;
            document.getElementById('deleteModal').style.display = 'block';
        }
        function showEditModal(postId, actorName, linkUrl, memo, author) {
            document.getElementById('editForm').action = '/edit/' + postId;
            document.getElementById('edit_actor_name').value = actorName;
            document.getElementById('edit_link_url').value = linkUrl;
            document.getElementById('edit_memo').value = memo;
            document.getElementById('edit_author').value = author;
            document.getElementById('editModal').style.display = 'block';
        }
    </script>
</body>
</html>
